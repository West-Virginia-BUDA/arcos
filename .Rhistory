theme(strip.text.x = element_text(size = 6))
View(annual_states)
ggplot(annual_states, aes(year, pills_per)) +
geom_col() +
facet_geo(~ BUYER_STATE, grid = "us_state_grid2") +
scale_x_continuous(labels = function(x) paste0("'", substr(x, 3, 4))) +
scale_y_continuous(label=comma) +
labs(title = "Annual oxycodone and hydrocodone pills per person by state",
caption = "Source: The Washington Post, ARCOS",
x = "",
y = "Dosage units") +
theme(strip.text.x = element_text(size = 6))
knitr::opts_chunk$set(
collapse = TRUE,
comment = "#>"
)
library(tidyverse)
library(arcos)
library(jsonlite)
library(knitr)
library(geofacet)
library(scales)
states <- combined_buyer_annual(key="WaPo")
kable(head(states))
annual_states <- states %>%
group_by(BUYER_STATE, year) %>%
summarize(pills=sum(DOSAGE_UNIT)) %>%
filter(!is.na(BUYER_STATE))
kable(head(states))
ggplot(annual_states, aes(year, pills)) +
geom_col() +
facet_geo(~ BUYER_STATE, grid = "us_state_grid2") +
scale_x_continuous(labels = function(x) paste0("'", substr(x, 3, 4))) +
scale_y_continuous(label=comma) +
labs(title = "Annual oxycodone and hydrocodone pills by state",
caption = "Source: The Washington Post, ARCOS",
x = "",
y = "Dosage units") +
theme(strip.text.x = element_text(size = 6))
population <- county_population(key="WaPo")
kable(head(population))
state_population <- population %>%
group_by(BUYER_STATE) %>%
summarize(population=sum(population, na.rm=T))
annual_states_joined <- left_join(annual_states, population) %>%
filter(!is.na(STATE))
kable(head(annual_states_joined))
annual_states_joined <- annual_states_joined %>%
mutate(pills_per=pills/population)
kable(head(annual_states))
View(annual_states)
state_population <- population %>%
group_by(BUYER_STATE) %>%
summarize(population=sum(population, na.rm=T))
annual_states_joined <- left_join(annual_states, state_population) %>%
filter(!is.na(STATE))
state_population <- population %>%
group_by(BUYER_STATE) %>%
summarize(population=sum(population, na.rm=T))
annual_states_joined <- left_join(annual_states, state_population)
kable(head(annual_states_joined))
state_population <- population %>%
group_by(BUYER_STATE) %>%
summarize(population=sum(population, na.rm=T))
annual_states_joined <- left_join(annual_states, state_population) %>%
filter(!is.na(population))
kable(head(annual_states_joined))
annual_states_joined <- annual_states_joined %>%
mutate(pills_per=pills/population)
kable(head(annual_states))
ggplot(annual_states, aes(year, pills_per)) +
geom_col() +
facet_geo(~ BUYER_STATE, grid = "us_state_grid2") +
scale_x_continuous(labels = function(x) paste0("'", substr(x, 3, 4))) +
scale_y_continuous(label=comma) +
labs(title = "Annual oxycodone and hydrocodone pills per person by state",
caption = "Source: The Washington Post, ARCOS",
x = "",
y = "Dosage units") +
theme(strip.text.x = element_text(size = 6))
ggplot(annual_states_joined, aes(year, pills_per)) +
geom_col() +
facet_geo(~ BUYER_STATE, grid = "us_state_grid2") +
scale_x_continuous(labels = function(x) paste0("'", substr(x, 3, 4))) +
scale_y_continuous(label=comma) +
labs(title = "Annual oxycodone and hydrocodone pills per person by state",
caption = "Source: The Washington Post, ARCOS",
x = "",
y = "Dosage units") +
theme(strip.text.x = element_text(size = 6))
knitr::opts_chunk$set(
collapse = TRUE,
comment = "#>"
)
library(arcos)
library(scales)
mingo <- total_pharmacies_county(county = "Mingo", state="WV", key="WaPo")
kable(head(mingo))
ggplot(mingo,
aes(x=total_dosage_unit, y=fct_reorder(buyer_name, total_dosage_unit))) +
geom_segment(
aes(x = 0,
y=fct_reorder(buyer_name, total_dosage_unit),
xend = total_dosage_unit,
yend = fct_reorder(buyer_name, total_dosage_unit)),
color = "gray50") +
geom_point() +
scale_x_continuous(label=comma) +
labs(x="Dosage units", y="",
title = "Pills sold at Mingo, WV pharmacies",
subtitle = "Between 2006 and 2012",
caption = "Data: The Washington Post, ARCOS") +
theme_minimal()
wv <- summarized_county_annual(state="WV", key="WaPo")
kable(head(wv))
library(tigris)
options(tigris_class = "sf")
wv_shape <- counties(state="WV", cb=T)
wv <- left_join(wv, wv_shape, by=c("countyfips"="GEOID"))
# If you dont have the viridis package installed yet, uncomment and run the line below
#install.packages("viridis")
library(viridis)
wv %>%
ggplot(aes(geometry=geometry, fill = DOSAGE_UNIT, color = DOSAGE_UNIT)) +
facet_wrap(~year, ncol=2) +
geom_sf() +
coord_sf(crs = 26915) +
scale_fill_viridis(direction=-1) +
scale_color_viridis(direction=-1) +
theme_void() +
theme(panel.grid.major = element_line(colour = 'transparent')) +
labs(title="Total oxycodone and hydrocodone pills in West Virginia", caption="Source: The Washington Post, ARCOS")
# If you dont have the viridis package installed yet, uncomment and run the line below
#install.packages("viridis")
library(viridis)
wv %>%
ggplot(aes(geometry=geometry, fill = DOSAGE_UNIT, color = DOSAGE_UNIT)) +
facet_wrap(~year, ncol=2) +
geom_sf() +
coord_sf(crs = 26915) +
scale_fill_viridis(direction=-1) +
scale_color_viridis(direction=-1) +
scale_y_continuous(formatter = comma) +
theme_void() +
theme(panel.grid.major = element_line(colour = 'transparent')) +
labs(title="Total oxycodone and hydrocodone pills in West Virginia", caption="Source: The Washington Post, ARCOS")
# If you dont have the viridis package installed yet, uncomment and run the line below
#install.packages("viridis")
library(viridis)
wv %>%
ggplot(aes(geometry=geometry, fill = DOSAGE_UNIT, color = DOSAGE_UNIT)) +
facet_wrap(~year, ncol=2) +
geom_sf() +
coord_sf(crs = 26915) +
scale_fill_viridis(direction=-1) +
scale_color_viridis(direction=-1) +
scale_y_continuous(format = comma) +
theme_void() +
theme(panel.grid.major = element_line(colour = 'transparent')) +
labs(title="Total oxycodone and hydrocodone pills in West Virginia", caption="Source: The Washington Post, ARCOS")
# If you dont have the viridis package installed yet, uncomment and run the line below
#install.packages("viridis")
library(viridis)
wv %>%
ggplot(aes(geometry=geometry, fill = DOSAGE_UNIT, color = DOSAGE_UNIT)) +
facet_wrap(~year, ncol=2) +
geom_sf() +
coord_sf(crs = 26915) +
scale_fill_viridis(direction=-1) +
scale_color_viridis(direction=-1) +
scale_y_continuous(label = comma) +
theme_void() +
theme(panel.grid.major = element_line(colour = 'transparent')) +
labs(title="Total oxycodone and hydrocodone pills in West Virginia", caption="Source: The Washington Post, ARCOS")
# If you dont have the viridis package installed yet, uncomment and run the line below
#install.packages("viridis")
library(viridis)
wv %>%
ggplot(aes(geometry=geometry, fill = DOSAGE_UNIT, color = DOSAGE_UNIT)) +
facet_wrap(~year, ncol=2) +
geom_sf() +
coord_sf(crs = 26915) +
scale_fill_viridis(direction=-1) +
scale_color_viridis(direction=-1) +
scale_fill_continuous(label = comma) +
theme_void() +
theme(panel.grid.major = element_line(colour = 'transparent')) +
labs(title="Total oxycodone and hydrocodone pills in West Virginia", caption="Source: The Washington Post, ARCOS")
# If you dont have the viridis package installed yet, uncomment and run the line below
#install.packages("viridis")
library(viridis)
wv %>%
ggplot(aes(geometry=geometry, fill = DOSAGE_UNIT, color = DOSAGE_UNIT)) +
facet_wrap(~year, ncol=2) +
geom_sf() +
coord_sf(crs = 26915) +
scale_fill_viridis(direction=-1) +
scale_color_viridis(direction=-1) +
scale_fill_continuous(label = comma) +
scale_color_continuous(label = comma) +
theme_void() +
theme(panel.grid.major = element_line(colour = 'transparent')) +
labs(title="Total oxycodone and hydrocodone pills in West Virginia", caption="Source: The Washington Post, ARCOS")
# If you dont have the viridis package installed yet, uncomment and run the line below
#install.packages("viridis")
library(viridis)
wv %>%
ggplot(aes(geometry=geometry, fill = DOSAGE_UNIT, color = DOSAGE_UNIT)) +
facet_wrap(~year, ncol=2) +
geom_sf() +
coord_sf(crs = 26915) +
scale_fill_viridis(direction=-1, label = comma) +
scale_color_viridis(direction=-1, label = comma) +
theme_void() +
theme(panel.grid.major = element_line(colour = 'transparent')) +
labs(title="Total oxycodone and hydrocodone pills in West Virginia", caption="Source: The Washington Post, ARCOS")
library(arcos)
library(tidyverse)
library(lubridate)
library(data.table)
library(formattable)
library(vroom)
library(stringr)
library(scales)
library(DT)
west_virginia <- total_pharmacies_county(state="WV", key="WaPo")
library(arcos)
library(tidyverse)
library(lubridate)
library(data.table)
library(formattable)
library(vroom)
library(stringr)
library(scales)
library(DT)
west_virginia <- total_pharmacies_state(state="WV", key="WaPo")
customGreen0 = "#DeF7E9"
customGreen = "#71CA97"
customRed = "#ff7f7f"
View(west_virginia)
library(arcos)
library(tidyverse)
library(lubridate)
library(data.table)
library(formattable)
library(vroom)
library(stringr)
library(scales)
library(DT)
west_virginia <- total_pharmacies_state(state="WV", key="WaPo")
datatable(west_virginia)
population <- county_population(state="WV", key="WaPo")
kable(head(population))
population <- population %>%
group_by(BUYER_COUNTY, BUYER_STATE, countyfips) %>%
summarize(average_population=mean(population, na.rm=T))
west_virginia_joined <- left_join(west_virginia, population)
west_virginia
west_virginia <- total_pharmacies_state(state="WV", key="WaPo")
View(west_virginia)
document()
devtools:document()
install.packages("devtools")
devtools:document()
devtools::document()
population <- state_population(key="WaPo")
library(arcos)
devtools::document()
library(arcos)
population <- state_population(key="WaPo")
devtools::document()
library(arcos)
population <- state_population(key="WaPo")
View(population)
View(state_population)
View(annual_states)
annual_states_joined <- left_join(annual_states, population) %>%
filter(!is.na(population))
View(annual_states_joined)
annual_states_joined <- annual_states_joined %>%
mutate(pills_per=pills/population)
kable(head(annual_states))
ggplot(annual_states_joined, aes(year, pills_per)) +
geom_col() +
facet_geo(~ BUYER_STATE, grid = "us_state_grid2") +
scale_x_continuous(labels = function(x) paste0("'", substr(x, 3, 4))) +
scale_y_continuous(label=comma) +
labs(title = "Annual oxycodone and hydrocodone pills per person by state",
caption = "Source: The Washington Post, ARCOS",
x = "",
y = "Dosage units") +
theme(strip.text.x = element_text(size = 6))
west_virginia <- total_pharmacies_state(state="WV", key="WaPo")
View(west_virginia)
knitr::opts_chunk$set(
collapse = TRUE,
comment = "#>"
)
packages <- c("scales", "tidyverse", "lubridate", "data.table", "formattable", "sringr", "DT")
if (length(setdiff(packages, rownames(installed.packages()))) > 0) {
install.packages(setdiff(packages, rownames(installed.packages())), repos = "http://cran.us.r-project.org")
}
library(arcos)
library(tidyverse)
library(lubridate)
library(data.table)
library(formattable)
library(vroom)
library(stringr)
library(scales)
library(DT)
west_virginia <- total_pharmacies_state(state="WV", key="WaPo")
datatable(west_virginia)
population <- county_population(state="WV", key="WaPo")
datatable(population)
population <- population %>%
group_by(BUYER_COUNTY, BUYER_STATE, countyfips) %>%
summarize(average_population=mean(population, na.rm=T)) %>%
## Have to quickly rename these columns to make them lower case so they'll join easily to the other data frame
rename(buyer_county=BUYER_COUNTY, buyer_state=BUYER_STATE)
wv_joined <- left_join(west_virginia, population)
datatable(wv_joined)
wv_joined <- wv_joined %>%
mutate(per_person=total_dosage_unit/average_population/7)
View(wv_joined)
devtools::document()
library(arcos)
library(arcos)
library(tidyverse)
library(lubridate)
library(data.table)
library(formattable)
library(vroom)
library(stringr)
library(scales)
library(DT)
west_virginia <- total_pharmacies_state(state="WV", key="WaPo")
datatable(west_virginia)
not_pharms <- not_pharmacies(key="WaPo")
View(not_pharms)
not_pharms <- not_pharmacies(key="WaPo") %>% pull(BUYER_DEA_NO)
wv_joined <- wv_joined %>%
filter(!BUYER_DEA_NO %in% not_pharms)
not_pharms <- not_pharmacies(key="WaPo") %>% pull(BUYER_DEA_NO)
wv_joined <- wv_joined %>%
filter(!not_pharms %in% BUYER_DEA_NO)
View(wv_joined)
not_pharms <- not_pharmacies(key="WaPo") %>% pull(BUYER_DEA_NO)
wv_joined <- wv_joined %>%
filter(!buyer_dea_no %in% not_pharms)
wv_joined <- wv_joined %>%
filter(!not_pharms %in% buyer_dea_no)
pharmacy_list <- buyer_addresses(state="WV", key="WaPo")
View(pharmacy_list)
pharmacy_list <- pharmacy_list %>%
select(buyer_dea_no=BUYER_DEA_NO, BUYER_BUS_ACT)
wv_joined <- left_join(wv_joined, pharmacy_list)
wv_joined <- wv_joined %>%
filter(BUYER_BUS_ACT=="RETAIL PHARMACY" | BUYER_BUS_ACT=="CHAIN PHARMACY")
View(wv_joined)
wv_joined <- wv_joined %>%
select(Pharmacy=buyer_name, City=buyer_city, County=buyer_county,
Pills=total_dosage_unit, `Pills per person`=per_person) %>%
mutate(`Pills per person`=round(`Pills per person`, 1))
knitr::opts_chunk$set(
collapse = TRUE,
comment = "#>"
)
packages <- c("scales", "tidyverse", "lubridate", "data.table", "formattable", "sringr", "DT")
if (length(setdiff(packages, rownames(installed.packages()))) > 0) {
install.packages(setdiff(packages, rownames(installed.packages())), repos = "http://cran.us.r-project.org")
}
library(arcos)
library(tidyverse)
library(lubridate)
library(data.table)
library(formattable)
library(vroom)
library(stringr)
library(scales)
library(DT)
west_virginia <- total_pharmacies_state(state="WV", key="WaPo")
datatable(west_virginia)
population <- county_population(state="WV", key="WaPo")
datatable(population)
population <- population %>%
group_by(BUYER_COUNTY, BUYER_STATE, countyfips) %>%
summarize(average_population=mean(population, na.rm=T)) %>%
## Have to quickly rename these columns to make them lower case so they'll join easily to the other data frame
rename(buyer_county=BUYER_COUNTY, buyer_state=BUYER_STATE)
wv_joined <- left_join(west_virginia, population)
datatable(wv_joined)
wv_joined <- wv_joined %>%
mutate(per_person=total_dosage_unit/average_population/7)
datatable(wv_joined)
pharmacy_list <- buyer_addresses(state="WV", key="WaPo")
# We just want the BUYER_BUS_ACT to tell if these are practitioners are retail pharmacies
pharmacy_list <- pharmacy_list %>%
select(buyer_dea_no=BUYER_DEA_NO, BUYER_BUS_ACT)
wv_joined <- left_join(wv_joined, pharmacy_list)
wv_joined <- wv_joined %>%
filter(BUYER_BUS_ACT=="RETAIL PHARMACY" | BUYER_BUS_ACT=="CHAIN PHARMACY")
not_pharms <- not_pharmacies(key="WaPo") %>% pull(BUYER_DEA_NO)
wv_joined <- wv_joined %>%
filter(!buyer_dea_no %in% not_pharms)
# clean it up
wv_joined <- wv_joined %>%
select(Pharmacy=buyer_name, City=buyer_city, County=buyer_county, `County population`=population,
Pills=total_dosage_unit, `Pills per person`=per_person) %>%
mutate(`Pills per person`=round(`Pills per person`, 1))
View(wv_joined)
wv_joined <- wv_joined %>%
select(Pharmacy=buyer_name, City=buyer_city, County=buyer_county, `County population`=average_population,
Pills=total_dosage_unit, `Pills per person`=per_person) %>%
mutate(`Pills per person`=round(`Pills per person`, 1))
wv_joined %>%
formattable(align=c("l", "l", "l", "r", "r", "r"),
list(Pharmacy = formatter("span", style = ~ style(color="grey", font.weight = "bold")),
Pills=color_tile(customGreen0, customGreen),
`Pills per person` = normalize_bar(customRed)
))
build_ste()
build_site()
pkgdown::build_site()
pkgdown::build_site()
pkgdown::build_site()
pkgdown::build_site()
pkgdown::build_site()
pkgdown::build_site()
pkgdown::build_site()
pkgdown::build_site()
pkgdown::build_site()
pkgdown::build_site()
pkgdown::build_site()
pkgdown::build_site()
pkgdown::build_site()
pkgdown::build_site()
pkgdown::build_site()
pkgdown::build_site()
library(arcos)
devtools::document()
pkgdown::build_site()
library(arcos)
pkgdown::build_site()
test_that("multiplication works", {
expect_equal(2 * 2, 4)
})
library(test_that)
library(testthat)
test_that("multiplication works", {
expect_equal(2 * 2, 4)
})
devtools::document()
library(arcos)
devtools:build()
devtools::build()
population <- county_population(state="TX", key="WaPo")
population
wv <- summarized_county_annual(state="TX", key="WaPo")
## Set the option for shapefiles to load with sf
options(tigris_class = "sf")
## Function to download county shapefiles in West Virginia
wv_shape <- counties(state="TX", cb=T)
## Join the county dosage data we pulled
wv <- left_join(wv, wv_shape, by=c("countyfips"="GEOID"))
library(tigris)
library(tidyverse)
## Set the option for shapefiles to load with sf
options(tigris_class = "sf")
## Function to download county shapefiles in West Virginia
wv_shape <- counties(state="TX", cb=T)
## Join the county dosage data we pulled
wv <- left_join(wv, wv_shape, by=c("countyfips"="GEOID"))
population <- county_population(state="TX", key="WaPo")
wv <- left_join(wv, population)
View(wv)
View(population)
wv <- summarized_county_annual(state="TX", key="WaPo")
wv_shape <- counties(state="TX", cb=T)
## Join the county dosage data we pulled
wv <- left_join(wv, wv_shape, by=c("countyfips"="GEOID"))
View(wv_shape)
population <- county_population(state="TX", key="WaPo") %>%
select(countyfips, year, population)
View(wv)
wv <- left_join(wv, population)
wv$per_person <- wv$DOSAGE_UNIT/wv$population
wv %>%
ggplot(aes(geometry=geometry, fill = per_person, color = per_person)) +
facet_wrap(~year, ncol=2) +
geom_sf() +
coord_sf(crs = 26915) +
scale_fill_viridis(direction=-1, label = comma) +
scale_color_viridis(direction=-1, label = comma) +
theme_void() +
theme(panel.grid.major = element_line(colour = 'transparent')) +
labs(title="Oxycodone and hydrocodone pills in West Virginia", caption="Source: The Washington Post, ARCOS")
library(knitr)
library(tigris)
library(viridis)
library(tidyverse)
library(scales)
wv %>%
ggplot(aes(geometry=geometry, fill = per_person, color = per_person)) +
facet_wrap(~year, ncol=2) +
geom_sf() +
coord_sf(crs = 26915) +
scale_fill_viridis(direction=-1, label = comma) +
scale_color_viridis(direction=-1, label = comma) +
theme_void() +
theme(panel.grid.major = element_line(colour = 'transparent')) +
labs(title="Oxycodone and hydrocodone pills in West Virginia", caption="Source: The Washington Post, ARCOS")
